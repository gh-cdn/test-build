/*!  The roject developed by chengpeiquan!  */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-283eb951"],{"2a42":function(e,t,n){},"2abc":function(e,t,n){!function(t,n){e.exports=n()}(0,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function e(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{u(a.next(e))}catch(e){i(e)}}function c(e){try{u(a.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}u((a=a.apply(e,t||[])).next())}))}function t(e,t){var n,a,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(r=2&i[0]?a.return:i[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(r=o.trys,!((r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}var n=function(e,t){return new Promise((function(n){var a=new FileReader;switch(t){case"base64":a.readAsDataURL(e);break;case"blob":a.readAsArrayBuffer(e)}a.onload=function(e){n(e.target.result)},a.onabort=function(){n(null)},a.onerror=function(){n(null)}}))};return function(a){return new Promise((function(r){if(!a)return r([]),!1;var i=Array.isArray(a)?function(e,t){for(var n=0,a=t.length,r=e.length;n<a;n++,r++)e[r]=t[n];return e}([],a):[a];r(e(void 0,void 0,void 0,(function(){var e,a,r,o,c,u,s;return t(this,(function(t){switch(t.label){case 0:e=[],a=0,t.label=1;case 1:return a<i.length?(r={base64:null,blob:null},o=i[a].type||"",[4,n(i[a],"base64")]):[3,5];case 2:return c=t.sent(),r.base64=c,[4,n(i[a],"blob")];case 3:u=t.sent(),s=new Blob([u],{type:o}),r.blob=s,e.push(r),t.label=4;case 4:return a++,[3,1];case 5:return[2,e]}}))})))}))}}))},"5e53":function(e,t,n){"use strict";var a=n("f3f3"),r=n("c964"),i=(n("96cf"),n("d81d"),n("d0ff")),o=(n("d3b7"),n("159b"),function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return new Promise((function(a){setTimeout((function(){if(t){var n=document.querySelectorAll(e),r=Object(i["a"])(n),o=[];r.forEach((function(e,t){var n="";t<r.length-1&&(n=r[t+1].getAttribute("id")||"");var a=e.innerHTML;o.push({id:e.getAttribute("id")||"",nextPlotId:n,template:a})})),a(o)}else{var c=document.querySelector(e),u={id:c?c.getAttribute("id"):"",nextPlotId:"",template:c?c.innerHTML:""};a(u)}}),n)}))}),c=o,u=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c(".render-canvas-plot",!0);case 2:if(t=e.sent,Array.isArray(t)){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",t.map((function(e){return Object(a["a"])(Object(a["a"])({},e),{},{extraInfo:{autoPlayConfig:{isOpen:!1,animation:"",nextPlotId:"",sceneRange:"",timeout:0},quickDialogueConfigList:[]}})})));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t["a"]=u},7495:function(e,t,n){"use strict";n.r(t);var a=n("c964"),r=(n("96cf"),n("4de4"),n("a9e3"),n("caad"),n("2532"),n("7a23")),i=n("6c02"),o=n("5502"),c=n("2abc"),u=n.n(c),s=n("2706"),l=n("be9c"),f=n("6256"),p=n("e160"),d=n("7782"),b=Object(r["defineComponent"])({expose:[],setup:function(e){var t=Object(i["d"])(),n=Object(o["b"])(),c=Object(r["computed"])((function(){return n.state})),b=Object(r["ref"])(0),v=Object(r["reactive"])([{isDisable:!1,text:"图片",list:s["b"].filter((function(e){return"picture"===e.elementInfo.category}))},{isDisable:!0,text:"视频",list:[]},{isDisable:!1,text:"剧情文本",list:s["b"].filter((function(e){return"text"===e.elementInfo.category}))},{isDisable:!0,text:"背景音乐",list:[]},{isDisable:!0,text:"效果音乐",list:[]},{isDisable:!0,text:"控件",list:[]},{isDisable:!0,text:"画面效果",list:[]}]),m=Object(r["computed"])((function(){return n.state.canvas.plotInfo.id})),g=Object(r["ref"])("请先选择剧情才能操作"),h=Object(r["ref"])(!1),y=Object(r["ref"])(0);y.value=t.params.id?Number(t.params.id):0;var x=function(){f["a"].warning(g.value)},w=function(e){var t=v[e].isDisable;t||(b.value=Number(e))},O=function(e){},j=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var a,r,i,o,c,s,l,d,b;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.target,h.value=!0,m.value){e.next=7;break}return x(),a.value="",h.value=!1,e.abrupt("return",!1);case 7:if(r=a.files[0]||{size:0,type:""},i=r.size,o=r.type,c=["image/png","image/jpeg","image/webp"],c.includes(o)){e.next=15;break}return f["a"].error("请选择jpg、png、webp格式的图片"),a.value="",h.value=!1,e.abrupt("return",!1);case 15:if(!(i>10485760)){e.next=20;break}return f["a"].error("图片大小不能超过10M"),a.value="",h.value=!1,e.abrupt("return",!1);case 20:return s=a.dataset.component||"",e.next=23,Object(p["a"])(r);case 23:if(l=e.sent,l){e.next=30;break}return e.next=27,u()(r);case 27:d=e.sent,b=d[0].base64,l=b;case 30:n.dispatch("canvas/receiveComponent",{componentTag:s,propValue:l}),a.value="",h.value=!1;case 33:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=function(e){var t={};"v-text-options"===e&&(t["fontFamily"]=l["a"].fontFamilyList[0].type,t["fontSize"]=16),n.dispatch("canvas/receiveComponent",{componentTag:e,propValue:{style:t,optionList:[{image:"",text:"默认"},{image:"",text:"默认"}],autoPlayConfig:{isOpen:!1,timeout:10}}})},D=function(){n.dispatch("canvas/receiveComponent",{componentTag:"v-normal-dialogue",propValue:{content:"请输入对话框内容",style:{fontFamily:l["a"].fontFamilyList[0].type,fontSize:16}}})};return Object(i["c"])((function(){Object(d["a"])(y.value,c.value)})),{route:t,store:n,state:c,curElementTypeIndex:b,elementTypeList:v,curPlotId:m,notAllowTips:g,isUploading:h,editorId:y,showNotAllowTips:x,changeElementType:w,handleDragStart:O,getFileInfo:j,addOptions:k,addDialogue:D,reactive:r["reactive"],ref:r["ref"],computed:r["computed"],onBeforeRouteLeave:i["c"],useRoute:i["d"],useStore:o["b"],readFile:u.a,componentList:s["b"],fontPreset:l["a"],message:f["a"],ossUpload:p["a"],saveCanvasData:d["a"]}}});n("bddb");b.__scopeId="data-v-71575cea";t["default"]=b},7782:function(e,t,n){"use strict";var a=n("c964"),r=(n("96cf"),n("d81d"),n("7db0"),n("d3b7"),n("a9e3"),n("caad"),n("2532"),n("2ef0")),i=n("6256"),o=n("0480"),c=n("9996"),u=n("5e53"),s={editorId:0,state:{},canvasData:[]},l=function(){var e={workId:s.editorId,chapterList:[]},t=s.state.chapter.list;return e["chapterList"]=t.map((function(e){var t={chapterNo:e.id,chapterName:e.title,plotList:[]};return t["plotList"]=e.plotList.map((function(e){var t=e.treeChildList.map((function(e){return String(e.target.plotId)})),n=s.canvasData.find((function(t){return t.id===e.id}))||{};return{autoPlayConfig:JSON.stringify(e.autoPlayConfig),componentData:JSON.stringify(e.componentData),content:JSON.stringify(n),cover:e.cover,name:e.title,no:e.id,targets:JSON.stringify(t),treeChildList:JSON.stringify(e.treeChildList)}})),t})),new Promise((function(t){Object(c["a"])({method:"post",url:"/interact/drama",data:e}).then((function(e){var n=e.code,a=e.msg||"";0!==n&&t({status:!1,msg:a}),t({status:!0,msg:"进度保存成功"})})).catch((function(e){t({status:!1,msg:e})}))}))},f=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,n){var a,c,f,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t&&n){e.next=3;break}return i["a"].error("保存进度出错，请检查传入的编辑器参数"),e.abrupt("return",!1);case 3:return s.editorId=Number(t),s.state=n,e.next=7,Object(u["a"])();case 7:if(s.canvasData=e.sent,window.location.host.includes("localhost")){e.next=15;break}return e.next=11,l();case 11:a=e.sent,c=a.status,f=a.msg,c?i["a"].success(f):i["a"].error(f);case 15:try{p=Object(r["cloneDeep"])(n),o["a"].setItem("id_".concat(t),p)}catch(d){console.log(d)}case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();t["a"]=f},bddb:function(e,t,n){"use strict";n("2a42")},be9c:function(e,t,n){"use strict";var a={fontFamilyList:[{type:"PingFangSC-Regular, PingFang SC, Microsoft YaHei, Helvetica Neue, Arial, HelveticaNeue, Helvetica, BBAlpha Sans, sans-serif",text:"默认"}],styleBtns:[{type:"b",text:"加粗"},{type:"i",text:"斜体"},{type:"u",text:"下划线"},{type:"left",text:"居左"},{type:"center",text:"居中"},{type:"right",text:"居右"}]};t["a"]=a},e160:function(e,t,n){"use strict";n("d3b7"),n("2ca0");var a=n("9996"),r=function(e){var t=new FormData;return t.append("file",e),new Promise((function(e){Object(a["a"])({method:"post",url:"/sys/oss/upload",headers:{"Content-Type":"multipart/form-data"},data:t}).then((function(t){var n=t.code;if(0!==n)return e(""),!1;var a=t.data;a.startsWith("http")||(a="https://"+a),e(a)})).catch((function(t){console.log(t),e("")}))}))};t["a"]=r}}]);