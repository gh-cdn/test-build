/*!  The roject developed by chengpeiquan!  */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["dialogue"],{"1a7f":function(e,t,n){"use strict";var r=n("7a23"),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file",theme:"outlined"},i=a,o=n("b3f0");function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){u(e,t,n[t])}))}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(e,t){var n=c({},e,t.attrs);return r["createVNode"](o["a"],r["mergeProps"](n,{icon:i}),null)};l.displayName="FileOutlined",l.inheritAttrs=!1;t["a"]=l},"23ae":function(e,t,n){"use strict";n("7939")},"256c":function(e,t,n){"use strict";n.r(t);n("cd17");var r=n("ed3b"),a=(n("a9e3"),n("7a23")),i=n("6c02"),o=n("5502"),c=n("5b0f"),u=(n("5704"),n("b558")),l=n("c964"),s=(n("2ef0f"),n("9839")),f=(n("96cf"),n("c740"),n("498a"),n("caad"),n("2532"),{icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 444H820V330.4c0-17.7-14.3-32-32-32H473L355.7 186.2a8.15 8.15 0 00-5.5-2.2H96c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h698c13 0 24.8-7.9 29.7-20l134-332c1.5-3.8 2.3-7.9 2.3-12 0-17.7-14.3-32-32-32zm-180 0H238c-13 0-24.8 7.9-29.7 20L136 643.2V256h188.5l119.6 114.4H748V444z"}}]},name:"folder-open",theme:"filled"}),d=f,p=n("b3f0");function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){v(e,t,n[t])}))}return e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function(e,t){var n=b({},e,t.attrs);return a["createVNode"](p["a"],a["mergeProps"](n,{icon:d}),null)};m.displayName="FolderOpenFilled",m.inheritAttrs=!1;var g=m,O=n("35c8"),h=n("1a7f"),w={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M892.1 737.8l-110.3-63.7a15.9 15.9 0 00-21.7 5.9l-19.9 34.5c-4.4 7.6-1.8 17.4 5.8 21.8L856.3 800a15.9 15.9 0 0021.7-5.9l19.9-34.5c4.4-7.6 1.7-17.4-5.8-21.8zM760 344a15.9 15.9 0 0021.7 5.9L892 286.2c7.6-4.4 10.2-14.2 5.8-21.8L878 230a15.9 15.9 0 00-21.7-5.9L746 287.8a15.99 15.99 0 00-5.8 21.8L760 344zm174 132H806c-8.8 0-16 7.2-16 16v40c0 8.8 7.2 16 16 16h128c8.8 0 16-7.2 16-16v-40c0-8.8-7.2-16-16-16zM625.9 115c-5.9 0-11.9 1.6-17.4 5.3L254 352H90c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h164l354.5 231.7c5.5 3.6 11.6 5.3 17.4 5.3 16.7 0 32.1-13.3 32.1-32.1V147.1c0-18.8-15.4-32.1-32.1-32.1z"}}]},name:"sound",theme:"filled"},y=w;function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){x(e,t,n[t])}))}return e}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var L=function(e,t){var n=j({},e,t.attrs);return a["createVNode"](p["a"],a["mergeProps"](n,{icon:y}),null)};L.displayName="SoundFilled",L.inheritAttrs=!1;var I=L,N=Object(a["defineComponent"])({expose:[],setup:function(e){var t=Object(a["useContext"])(),n=t.expose,i=Object(a["ref"])(!1),o=Object(a["reactive"])([{title:"音乐文件",isOpen:!0,list:[{id:1,title:"你是我心内的一首歌"},{id:2,title:"咿呀咿呀哟"},{id:3,title:"万里长城永不倒"}]},{title:"音效文件",isOpen:!0,list:[{id:1,title:"你是我心内的一首歌"},{id:2,title:"咿呀咿呀哟"},{id:3,title:"万里长城永不倒"}]}]),c=function(){i.value=!1},u=function(e){o[e].isOpen=!o[e].isOpen},l=function(e){console.log(e),c()};return n({isShowDialog:i}),{ctx:t,expose:n,isShowDialog:i,dubbingList:o,close:c,toggleList:u,selectDubbing:l,reactive:a["reactive"],ref:a["ref"],useContext:a["useContext"],Modal:r["a"],FolderOpenFilled:g,DownOutlined:O["a"],FileOutlined:h["a"],SoundFilled:I}}});n("5114");N.__scopeId="data-v-5b3b559b";var D=N,P=n("6256"),S=Object(a["defineComponent"])({expose:[],props:{editorId:Number,dialogueIndex:Number,dialogueInfo:Object},setup:function(e){var t=e,n=s["b"].Option,i=Object(o["b"])(),c=Object(a["computed"])((function(){return i.state.dialogue.roleList})),f=Object(a["ref"])(null),d=Object(a["ref"])(0),p=Object(a["ref"])(!1),b=Object(a["ref"])(""),v=Object(a["ref"])(null),m=Object(a["reactive"])({styleList:[{type:"default",text:"默认样式"}],roleList:c.value,positionList:[{type:"left",text:"居左"},{type:"right",text:"居右"}]}),g=Object(a["reactive"])({styleType:"default",positionType:"left",roleName:"默认"}),O=function(e){if("+ 新增角色名称"===e)return p.value=!0,b.value="",!1;j("roleName")},h=function(e){if(!e)return!1;var t=m.roleList.findIndex((function(e){return e===g.roleName}));d.value=-1===t?0:t},w=function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=b.value.trim(),n){e.next=4;break}return P["a"].warning("请输入角色名"),e.abrupt("return",!1);case 4:if(!m.roleList.includes(n)){e.next=7;break}return P["a"].warning("该角色已创建，请输入其他名称"),e.abrupt("return",!1);case 7:return e.next=9,i.dispatch("dialogue/addRole",{editorId:t.editorId,roleName:b.value});case 9:if(r=e.sent,r){e.next=12;break}return e.abrupt("return");case 12:p.value=!1,g.roleName=b.value,j("roleName");case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y=function(){P["a"].warning("配音功能暂未开放，敬请期待！")},j=function(e){i.commit("dialogue/updateDialogue",{index:t.dialogueIndex,key:e,newValue:g[e]})},x=function(){var e=t.dialogueInfo;e&&(g.styleType=e.styleType,g.positionType=e.positionType,g.roleName=e.roleName)};return Object(a["watchEffect"])(x),Object(a["watch"])((function(){return p.value}),(function(){p.value&&setTimeout((function(){v.value.focus()}),100),p.value||(v.value="")})),Object(a["watch"])((function(){return c.value}),(function(){m.roleList=c.value})),{props:t,Option:n,store:i,roleList:c,dubbingListDialog:f,prevRoleNameIndex:d,isShowAddRoleNameDialog:p,newRoleName:b,newRoleNameDOM:v,options:m,newInfo:g,selectRoleName:O,updatePrevRoleNameIndex:h,addRoleName:w,openDubbingList:y,updateDialogue:j,loadInfo:x,computed:a["computed"],reactive:a["reactive"],ref:a["ref"],watch:a["watch"],watchEffect:a["watchEffect"],useStore:o["b"],Modal:r["a"],Select:s["b"],Input:u["a"],DubbingList:D,message:P["a"]}}});n("d37a");S.__scopeId="data-v-788fe1d0";var k=S,R=n("2abc"),C=n.n(R),M=n("e160"),V=Object(a["defineComponent"])({expose:[],props:{dialogueIndex:Number,dialogueInfo:Object},setup:function(e){var t=e,n=Object(o["b"])(),r=Object(a["ref"])(!0),i=Object(a["ref"])(!1),c=Object(a["reactive"])({pic:"",content:""}),u=function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t){var n,a,o,u,l,s,d,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.target,i.value=!0,a=n.files[0]||{size:0,type:""},o=a.size,u=a.type,l=["image/png","image/jpeg","image/webp"],l.includes(u)){e.next=10;break}return message.error("请选择jpg、png、webp格式的图片"),n.value="",i.value=!1,e.abrupt("return",!1);case 10:if(!(o>10485760)){e.next=15;break}return message.error("图片大小不能超过10M"),n.value="",i.value=!1,e.abrupt("return",!1);case 15:return e.next=17,Object(M["a"])(a);case 17:if(s=e.sent,s){e.next=24;break}return e.next=21,C()(a);case 21:d=e.sent,p=d[0].base64,s=p;case 24:c.pic=s,r.value=!1,f("pic"),n.value="",i.value=!1;case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s=function(){c.pic="",setTimeout((function(){r.value=!0}),10)},f=function(e){n.commit("dialogue/updateDialogue",{index:t.dialogueIndex,key:e,newValue:c[e]})},d=function(){var e=t.dialogueInfo;e&&(c.pic=e.pic,c.content=e.content,c.pic&&(r.value=!1))};return Object(a["watchEffect"])(d),{props:t,store:n,isShowUpload:r,isUploading:i,newInfo:c,getFileInfo:u,remove:s,updateDialogue:f,loadInfo:d,reactive:a["reactive"],ref:a["ref"],watch:a["watch"],watchEffect:a["watchEffect"],useStore:o["b"],readFile:C.a,ossUpload:M["a"]}}});n("6f49");V.__scopeId="data-v-88c64b5a";var E=V,T=n("7782"),A=Object(a["defineComponent"])({expose:[],setup:function(e){var t=Object(i["d"])(),n=Object(i["e"])(),u=Object(o["b"])(),l=Object(a["computed"])((function(){return u.state})),s=Object(a["computed"])((function(){return u.state.property.data.element})),f=Object(a["ref"])(-1),d=Object(a["computed"])((function(){return u.state.dialogue.list})),p=Object(a["computed"])((function(){return"true"===t.query.isEdit})),b=Object(a["ref"])(0);b.value=t.params.id?Number(t.params.id):0;var v=function(e){if(0===d.value.length)return!1;u.commit("dialogue/toggleDialogue",e)},m=function(){if(0===d.value.length)return!1;if(f.value<0)return P["a"].warning("请先选中要删除的对话"),!1;var e=r["a"].confirm(),t=d.value[f.value].id||"";e.update({content:"确认要删除 ID 为 ".concat(t," 的对话吗？"),onOk:function(){return g(e)}})},g=function(e){e.destroy(),u.commit("dialogue/removeDialogue",f.value),setTimeout((function(){f.value=-1}),10)},O=function(){if(p.value){var e=s.value.propValue,r=e.triggerMode,a=e.speed;u.commit("canvas/updateComponent",{target:s.value,newInfo:{type:"propValue",value:{triggerMode:r,speed:a,list:d.value}}})}else u.dispatch("canvas/receiveComponent",{componentTag:"v-quick-dialogue",propValue:{triggerMode:"fullScreen",speed:1,list:d.value}});Object(T["a"])(b.value,l.value),setTimeout((function(){n.push({name:"editor",params:{id:t.params.id}})}),1500)},h=function(){n.push({name:"editor",params:{id:t.params.id}})},w=function(){var e=s.value.propValue.list;u.commit("dialogue/loadList",e)};return u.commit("dialogue/resetList"),u.dispatch("dialogue/getRoleList",b.value),p.value&&w(),{route:t,router:n,store:u,state:l,curElement:s,curIndex:f,dialogueList:d,isEdit:p,editorId:b,toggleDialogue:v,confirmRemove:m,removeDialogue:g,save:O,cancel:h,loadList:w,computed:a["computed"],reactive:a["reactive"],ref:a["ref"],onMounted:a["onMounted"],useRoute:i["d"],useRouter:i["e"],useStore:o["b"],Modal:r["a"],CaretDownFilled:c["a"],SelectArea:k,ContentArea:E,message:P["a"],saveCanvasData:T["a"]}}});n("23ae");A.__scopeId="data-v-619588e8";t["default"]=A},"2ff7":function(e,t,n){},"498a":function(e,t,n){"use strict";var r=n("23e7"),a=n("58a8").trim,i=n("c8d2");r({target:"String",proto:!0,forced:i("trim")},{trim:function(){return a(this)}})},5114:function(e,t,n){"use strict";n("2ff7")},"5b0f":function(e,t,n){"use strict";var r=n("7a23"),a={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"}}]},name:"caret-down",theme:"filled"},i=a,o=n("b3f0");function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){u(e,t,n[t])}))}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(e,t){var n=c({},e,t.attrs);return r["createVNode"](o["a"],r["mergeProps"](n,{icon:i}),null)};l.displayName="CaretDownFilled",l.inheritAttrs=!1;t["a"]=l},"5e53":function(e,t,n){"use strict";var r=n("f3f3"),a=n("c964"),i=(n("96cf"),n("d81d"),n("d0ff")),o=(n("d3b7"),n("159b"),function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return new Promise((function(r){setTimeout((function(){if(t){var n=document.querySelectorAll(e),a=Object(i["a"])(n),o=[];a.forEach((function(e,t){var n="";t<a.length-1&&(n=a[t+1].getAttribute("id")||"");var r=e.innerHTML;o.push({id:e.getAttribute("id")||"",nextPlotId:n,template:r})})),r(o)}else{var c=document.querySelector(e),u={id:c?c.getAttribute("id"):"",nextPlotId:"",template:c?c.innerHTML:""};r(u)}}),n)}))}),c=o,u=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c(".render-canvas-plot",!0);case 2:if(t=e.sent,Array.isArray(t)){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",t.map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{extraInfo:{autoPlayConfig:{isOpen:!1,animation:"",nextPlotId:"",sceneRange:"",timeout:0},quickDialogueConfigList:[]}})})));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t["a"]=u},"61ca":function(e,t,n){},"6f49":function(e,t,n){"use strict";n("c222")},7782:function(e,t,n){"use strict";var r=n("c964"),a=(n("96cf"),n("d81d"),n("7db0"),n("d3b7"),n("a9e3"),n("caad"),n("2532"),n("2ef0")),i=n("6256"),o=n("0480"),c=n("9996"),u=n("5e53"),l={editorId:0,state:{},canvasData:[]},s=function(){var e={workId:l.editorId,chapterList:[]},t=l.state.chapter.list;return e["chapterList"]=t.map((function(e){var t={chapterNo:e.id,chapterName:e.title,plotList:[]};return t["plotList"]=e.plotList.map((function(e){var t=e.treeChildList.map((function(e){return String(e.target.plotId)})),n=l.canvasData.find((function(t){return t.id===e.id}))||{};return{autoPlayConfig:JSON.stringify(e.autoPlayConfig),componentData:JSON.stringify(e.componentData),content:JSON.stringify(n),cover:e.cover,name:e.title,no:e.id,targets:JSON.stringify(t),treeChildList:JSON.stringify(e.treeChildList)}})),t})),new Promise((function(t){Object(c["a"])({method:"post",url:"/interact/drama",data:e}).then((function(e){var n=e.code,r=e.msg||"";0!==n&&t({status:!1,msg:r}),t({status:!0,msg:"进度保存成功"})})).catch((function(e){t({status:!1,msg:e})}))}))},f=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){var r,c,f,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t&&n){e.next=3;break}return i["a"].error("保存进度出错，请检查传入的编辑器参数"),e.abrupt("return",!1);case 3:return l.editorId=Number(t),l.state=n,e.next=7,Object(u["a"])();case 7:if(l.canvasData=e.sent,window.location.host.includes("localhost")){e.next=15;break}return e.next=11,s();case 11:r=e.sent,c=r.status,f=r.msg,c?i["a"].success(f):i["a"].error(f);case 15:try{d=Object(a["cloneDeep"])(n),o["a"].setItem("id_".concat(t),d)}catch(p){console.log(p)}case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();t["a"]=f},7939:function(e,t,n){},c222:function(e,t,n){},c8d2:function(e,t,n){var r=n("d039"),a=n("5899"),i="​᠎";e.exports=function(e){return r((function(){return!!a[e]()||i[e]()!=i||a[e].name!==e}))}},d37a:function(e,t,n){"use strict";n("61ca")}}]);