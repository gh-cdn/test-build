/*!  The roject developed by chengpeiquan!  */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["editor","chunk-5a0891e1","chunk-bfabc336","chunk-1513eee3","chunk-f14e4aa0","chunk-1009bb63","chunk-7e043960"],{"0ca4":function(e,t,n){"use strict";n.r(t);var a=n("f3f3"),o=(n("a9e3"),n("7a23")),r=n("5502"),c=n("4ac8"),i=Object(o["defineComponent"])({expose:[],props:{isCur:Boolean,id:[Number,String],element:Object,defaultStyle:Object,index:[Number,String]},setup:function(e){var t=e,n=Object(r["b"])(),i=Object(o["computed"])((function(){return n.state.canvas.componentData})),u=function(e){e.stopPropagation(),e.preventDefault()},s=function(e){var r=t.element,i=void 0===r?{}:r;if(n.commit("canvas/setClickComponentStatus",!0),"v-text"!=i.component&&"rect-shape"!=i.component&&e.preventDefault(),e.stopPropagation(),n.commit("canvas/setCurComponent",{component:i,index:t.index}),Object(c["a"])(i),i.isLock||"v-bg"===i.component||"v-quick-dialogue"===i.component)return!1;var u=Object(a["a"])({},t.defaultStyle),s=e.clientY,f=e.clientX,p=Number(u.top),l=Number(u.left),d=function(e){!0;var t=e.clientX,a=e.clientY;u.top=a-s+p,u.left=t-f+l,n.commit("canvas/setShapeStyle",u),Object(o["nextTick"])((function(){}))},v=function e(){document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",e)};document.addEventListener("mousemove",d),document.addEventListener("mouseup",v)};return{props:t,store:n,componentData:i,selectCurComponent:u,handleMouseDownOnShape:s,computed:o["computed"],nextTick:o["nextTick"],useStore:r["b"],changePanel:c["a"]}}});n("fd38");i.__scopeId="data-v-7f58d0b6";t["default"]=i},"1d60":function(e,t,n){"use strict";n("4d83")},"1f3b":function(e,t,n){"use strict";n.r(t);var a=n("7a23"),o=n("5502"),r=n("c584"),c=n("2706"),i=Object(a["defineComponent"])({expose:[],setup:function(e){var t=Object(o["b"])(),n=Object(a["computed"])((function(){return t.state.canvas.isClickComponent})),i=Object(a["computed"])((function(){return t.state.editorInfo.canvasnSize})),u=function(e){if(e.preventDefault(),e.stopPropagation(),e.dataTransfer){var n=e.dataTransfer.getData("component");t.dispatch("canvas/receiveComponent",{componentTag:n})}},s=function(e){e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")},f=function(){t.commit("canvas/setClickComponentStatus",!1)};return{store:t,isClickComponent:n,canvasnSize:i,handleDrop:u,handleDragOver:s,handleMouseDown:f,computed:a["computed"],reactive:a["reactive"],watchEffect:a["watchEffect"],useStore:o["b"],Canvas:r["default"],componentList:c["b"]}}});n("1d60");i.__scopeId="data-v-774918ed";t["default"]=i},"2a42":function(e,t,n){},"3d60":function(e,t,n){"use strict";n("fef0")},"4ac8":function(e,t,n){"use strict";var a=n("0613"),o=function(e){var t="";switch(e.component){case"v-bg":case"v-avatar":case"v-props":case"v-role":t="img";break;case"v-text-options":case"v-image-options":t="options";break;case"v-normal-dialogue":t="normal-dialogue";break;case"v-quick-dialogue":t="quick-dialogue";break}a["a"].commit("property/changePanel",{type:t,data:e})};t["a"]=o},"4d83":function(e,t,n){},5909:function(e,t,n){},"5e53":function(e,t,n){"use strict";var a=n("f3f3"),o=n("c964"),r=(n("96cf"),n("d81d"),n("d0ff")),c=(n("d3b7"),n("159b"),function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return new Promise((function(a){setTimeout((function(){if(t){var n=document.querySelectorAll(e),o=Object(r["a"])(n),c=[];o.forEach((function(e,t){var n="";t<o.length-1&&(n=o[t+1].getAttribute("id")||"");var a=e.innerHTML;c.push({id:e.getAttribute("id")||"",nextPlotId:n,template:a})})),a(c)}else{var i=document.querySelector(e),u={id:i?i.getAttribute("id"):"",nextPlotId:"",template:i?i.innerHTML:""};a(u)}}),n)}))}),i=c,u=function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i(".render-canvas-plot",!0);case 2:if(t=e.sent,Array.isArray(t)){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",t.map((function(e){return Object(a["a"])(Object(a["a"])({},e),{},{extraInfo:{autoPlayConfig:{isOpen:!1,animation:"",nextPlotId:"",sceneRange:"",timeout:0},quickDialogueConfigList:[]}})})));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t["a"]=u},"675a":function(e,t,n){"use strict";n("a52e")},"6f6c":function(e,t,n){"use strict";n("5909")},7061:function(e,t,n){"use strict";n("159b");var a=function(e){if(!e)return!1;if(0===e.length)return!1;var t=0;return e.forEach((function(e){return t+=e.plotList.length})),t>0};t["a"]=a},7495:function(e,t,n){"use strict";n.r(t);var a=n("c964"),o=(n("96cf"),n("4de4"),n("a9e3"),n("caad"),n("2532"),n("7a23")),r=n("6c02"),c=n("5502"),i=n("2abc"),u=n.n(i),s=n("2706"),f=n("be9c"),p=n("6256"),l=n("e160"),d=n("7782"),v=Object(o["defineComponent"])({expose:[],setup:function(e){var t=Object(r["d"])(),n=Object(c["b"])(),i=Object(o["computed"])((function(){return n.state})),v=Object(o["ref"])(0),m=Object(o["reactive"])([{isDisable:!1,text:"图片",list:s["b"].filter((function(e){return"picture"===e.elementInfo.category}))},{isDisable:!0,text:"视频",list:[]},{isDisable:!1,text:"剧情文本",list:s["b"].filter((function(e){return"text"===e.elementInfo.category}))},{isDisable:!0,text:"背景音乐",list:[]},{isDisable:!0,text:"效果音乐",list:[]},{isDisable:!0,text:"控件",list:[]},{isDisable:!0,text:"画面效果",list:[]}]),b=Object(o["computed"])((function(){return n.state.canvas.plotInfo.id})),g=Object(o["ref"])("请先选择剧情才能操作"),h=Object(o["ref"])(!1),O=Object(o["ref"])(0);O.value=t.params.id?Number(t.params.id):0;var j=function(){p["a"].warning(g.value)},y=function(e){var t=m[e].isDisable;t||(v.value=Number(e))},x=function(e){},w=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var a,o,r,c,i,s,f,d,v;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.target,h.value=!0,b.value){e.next=7;break}return j(),a.value="",h.value=!1,e.abrupt("return",!1);case 7:if(o=a.files[0]||{size:0,type:""},r=o.size,c=o.type,i=["image/png","image/jpeg","image/webp"],i.includes(c)){e.next=15;break}return p["a"].error("请选择jpg、png、webp格式的图片"),a.value="",h.value=!1,e.abrupt("return",!1);case 15:if(!(r>10485760)){e.next=20;break}return p["a"].error("图片大小不能超过10M"),a.value="",h.value=!1,e.abrupt("return",!1);case 20:return s=a.dataset.component||"",e.next=23,Object(l["a"])(o);case 23:if(f=e.sent,f){e.next=30;break}return e.next=27,u()(o);case 27:d=e.sent,v=d[0].base64,f=v;case 30:n.dispatch("canvas/receiveComponent",{componentTag:s,propValue:f}),a.value="",h.value=!1;case 33:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(e){var t={};"v-text-options"===e&&(t["fontFamily"]=f["a"].fontFamilyList[0].type,t["fontSize"]=16),n.dispatch("canvas/receiveComponent",{componentTag:e,propValue:{style:t,optionList:[{image:"",text:"默认"},{image:"",text:"默认"}],autoPlayConfig:{isOpen:!1,timeout:10}}})},D=function(){n.dispatch("canvas/receiveComponent",{componentTag:"v-normal-dialogue",propValue:{content:"请输入对话框内容",style:{fontFamily:f["a"].fontFamilyList[0].type,fontSize:16}}})};return Object(r["c"])((function(){Object(d["a"])(O.value,i.value)})),{route:t,store:n,state:i,curElementTypeIndex:v,elementTypeList:m,curPlotId:b,notAllowTips:g,isUploading:h,editorId:O,showNotAllowTips:j,changeElementType:y,handleDragStart:x,getFileInfo:w,addOptions:C,addDialogue:D,reactive:o["reactive"],ref:o["ref"],computed:o["computed"],onBeforeRouteLeave:r["c"],useRoute:r["d"],useStore:c["b"],readFile:u.a,componentList:s["b"],fontPreset:f["a"],message:p["a"],ossUpload:l["a"],saveCanvasData:d["a"]}}});n("bddb");v.__scopeId="data-v-71575cea";t["default"]=v},7782:function(e,t,n){"use strict";var a=n("c964"),o=(n("96cf"),n("d81d"),n("7db0"),n("d3b7"),n("a9e3"),n("caad"),n("2532"),n("2ef0")),r=n("6256"),c=n("0480"),i=n("9996"),u=n("5e53"),s={editorId:0,state:{},canvasData:[]},f=function(){var e={workId:s.editorId,chapterList:[]},t=s.state.chapter.list;return e["chapterList"]=t.map((function(e){var t={chapterNo:e.id,chapterName:e.title,plotList:[]};return t["plotList"]=e.plotList.map((function(e){var t=e.treeChildList.map((function(e){return String(e.target.plotId)})),n=s.canvasData.find((function(t){return t.id===e.id}))||{};return{autoPlayConfig:JSON.stringify(e.autoPlayConfig),componentData:JSON.stringify(e.componentData),content:JSON.stringify(n),cover:e.cover,name:e.title,no:e.id,targets:JSON.stringify(t),treeChildList:JSON.stringify(e.treeChildList)}})),t})),new Promise((function(t){Object(i["a"])({method:"post",url:"/interact/drama",data:e}).then((function(e){var n=e.code,a=e.msg||"";0!==n&&t({status:!1,msg:a}),t({status:!0,msg:"进度保存成功"})})).catch((function(e){t({status:!1,msg:e})}))}))},p=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,n){var a,i,p,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t&&n){e.next=3;break}return r["a"].error("保存进度出错，请检查传入的编辑器参数"),e.abrupt("return",!1);case 3:return s.editorId=Number(t),s.state=n,e.next=7,Object(u["a"])();case 7:if(s.canvasData=e.sent,window.location.host.includes("localhost")){e.next=15;break}return e.next=11,f();case 11:a=e.sent,i=a.status,p=a.msg,i?r["a"].success(p):r["a"].error(p);case 15:try{l=Object(o["cloneDeep"])(n),c["a"].setItem("id_".concat(t),l)}catch(d){console.log(d)}case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();t["a"]=p},"8c89":function(e,t,n){},a32d:function(e,t,n){"use strict";n.r(t);var a=n("f3f3"),o=n("d0ff"),r=n("c964"),c=(n("99af"),n("c740"),n("caad"),n("2532"),n("159b"),n("96cf"),n("7a23")),i=n("5502"),u=n("2ef0"),s=n("88ed"),f=n("5e53"),p=Object(c["defineComponent"])({expose:[],setup:function(e){var t=Object(c["useContext"])(),n=t.expose,p=Object(c["ref"])(!1),l=Object(i["b"])(),d=Object(c["computed"])((function(){return l.state.chapter.list})),v=Object(c["computed"])((function(){return l.state.editorInfo.canvasnSize})),m=Object(c["reactive"])({url:"/preview/index.html",dom:null,window:null,preset:{screenMode:"landscape",plotList:[]}}),b=Object(c["toRef"])(m,"dom"),g=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(f["a"])();case 2:m.preset.plotList=e.sent,h();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){p.value=!0,setTimeout((function(){O()}),10)},O=function(){b.value&&(m.window=m.dom.contentWindow,setTimeout((function(){j()}),1e3))},j=function(){var e=Object(u["cloneDeep"])(m.preset);m.window.postMessage(e,"*")},y=function(e,t,n){n||(n={}),x(e,t,n);var a=n,o=a.id,r=e.component,c=e.eventList,i=e.id;e.propValue;if("v-image-options"===r||"v-text-options"===r)return"__APP__.selectOption(window.event, '".concat(JSON.stringify(c),"')");if("v-quick-dialogue"===r)return"__APP__.changeQuickDialogue(window.event, '".concat(i,"', '").concat(o,"')");if(c.length>0){var u=c[0].target;return"__APP__.changePlot('".concat(u,"', '").concat(JSON.stringify(c[0]),"')")}},x=function(e,t,n){var r=n.id,c=e.component,i=e.id,u=e.propValue,s=m.preset.plotList.findIndex((function(e){return e.template.includes(i)}));if(-1!==s&&(function(){var e=[],n=t.componentData;n.forEach((function(t){e=[].concat(Object(o["a"])(e),Object(o["a"])(t.eventList))})),0===e.length&&(m.preset.plotList[s].extraInfo.autoPlayConfig=Object(a["a"])({nextPlotId:r},t.autoPlayConfig)),"v-text-options"!==c&&"v-image-options"!==c||(m.preset.plotList[s].extraInfo.autoPlayConfig=Object(a["a"])({nextPlotId:r},u.autoPlayConfig))}(),"v-quick-dialogue"===c)){var f=Object(a["a"])({id:i},u);m.preset.plotList[s].extraInfo.quickDialogueConfigList.push(f)}};return n({getCanvasData:g}),{expose:n,isShowDialog:p,store:l,chapterList:d,canvasnSize:v,iframe:m,iframeDom:b,getCanvasData:g,showDialog:h,getIframe:O,setIframeContent:j,getEvent:y,getExtraInfo:x,computed:c["computed"],reactive:c["reactive"],ref:c["ref"],toRef:c["toRef"],useContext:c["useContext"],watchEffect:c["watchEffect"],useStore:i["b"],cloneDeep:u["cloneDeep"],getStyle:s["f"],getComponentStyle:s["d"],getShapeStyle:s["e"],bindClassList:s["a"],renderCanvas:f["a"]}}});n("bac1");p.__scopeId="data-v-2017a4b4";t["default"]=p},a52e:function(e,t,n){},bac1:function(e,t,n){"use strict";n("f524")},bddb:function(e,t,n){"use strict";n("2a42")},be9c:function(e,t,n){"use strict";var a={fontFamilyList:[{type:"PingFangSC-Regular, PingFang SC, Microsoft YaHei, Helvetica Neue, Arial, HelveticaNeue, Helvetica, BBAlpha Sans, sans-serif",text:"默认"}],styleBtns:[{type:"b",text:"加粗"},{type:"i",text:"斜体"},{type:"u",text:"下划线"},{type:"left",text:"居左"},{type:"center",text:"居中"},{type:"right",text:"居右"}]};t["a"]=a},c584:function(e,t,n){"use strict";n.r(t);var a=n("7a23"),o=n("5502"),r=n("0ca4"),c=n("88ed"),i=Object(a["defineComponent"])({expose:[],setup:function(e){var t=Object(o["b"])(),n=Object(a["computed"])((function(){return t.state.canvas.componentData})),i=Object(a["computed"])((function(){try{return t.state.property.data.element.id}catch(e){return""}})),u=function(e){e.stopPropagation(),e.preventDefault()},s=function(){},f=function(e,t){};return{store:t,elementList:n,curComponentId:i,handleContextMenu:u,handleMouseDown:s,handleInput:f,computed:a["computed"],useStore:o["b"],Shape:r["default"],getStyle:c["f"],getComponentStyle:c["d"],getShapeStyle:c["e"],bindClassList:c["a"]}}});n("6f6c");i.__scopeId="data-v-ba8fcbee";t["default"]=i},f524:function(e,t,n){},f73c:function(e,t,n){"use strict";n.r(t);n("a9e3"),n("caad"),n("2532");var a=n("7a23"),o=n("6c02"),r=n("5502"),c=n("2ef0"),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M946.5 505L534.6 93.4a31.93 31.93 0 00-45.2 0L77.5 505c-12 12-18.8 28.3-18.8 45.3 0 35.3 28.7 64 64 64h43.4V908c0 17.7 14.3 32 32 32H448V716h112v224h265.9c17.7 0 32-14.3 32-32V614.3h43.4c17 0 33.3-6.7 45.3-18.8 24.9-25 24.9-65.5-.1-90.5z"}}]},name:"home",theme:"filled"},u=i,s=n("b3f0");function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},a=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){p(e,t,n[t])}))}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(e,t){var n=f({},e,t.attrs);return a["createVNode"](s["a"],a["mergeProps"](n,{icon:u}),null)};l.displayName="HomeFilled",l.inheritAttrs=!1;var d=l,v=n("51c5"),m=n("fdaa"),b=n("7495"),g=n("1f3b"),h=n("a32d"),O=function(){var e="确认要离开吗？记得先保存编辑器的修改！";window.onbeforeunload=function(t){t&&(t.returnValue=e)},Object(o["c"])((function(t,n){var a=window.confirm(e);if(!a)return!1}))},j=O,y=n("6256"),x=n("0480"),w=n("7061"),C=n("7782"),D=(n("b0c0"),n("0613")),I=n("b6f1"),S=function(e,t){var n=t.chapterList;D["a"].dispatch("restore",{editorId:e,chapterList:n});var a=I["a"].canvasWidth,o=I["a"].canvasHeight,r=t.works;r&&D["a"].commit("setEditorInfo",{id:e,title:r.name||"",type:0===r.chargeType?"免费作品":"收费作品",mode:0===r.interactType?"横屏":"竖屏",count:r.plotNum||0,cover:r.cover||"",createTime:r.updateTime||"",publishState:0===r.status?"Hoo平台状态：未发布":"Hoo平台状态：已发布",canvasnSize:{width:0===r.interactType?o:a,height:0===r.interactType?a:o}})},L=S,P=n("9996"),k=n("57b6"),T=Object(a["defineComponent"])({expose:[],setup:function(e){var t=Object(o["d"])(),n=Object(o["e"])(),i=Object(r["b"])(),u=Object(a["computed"])((function(){return i.state})),s=Object(a["computed"])((function(){return i.state.property.component})),f=Object(a["computed"])((function(){return i.state.chapter.list})),p=Object(a["ref"])(null),l=Object(a["ref"])(0);l.value=t.params.id?Number(t.params.id):0;var O=function(){Object(C["a"])(l.value,u.value),setTimeout((function(){n.push({name:"tree",params:{id:t.params.id}})}),100)},D=function(){var e=Object(w["a"])(f.value);if(!e)return y["a"].warning("请先创建剧情"),!1;Object(C["a"])(l.value,u.value),p.value&&p.value.getCanvasData()},I=function(){window.open("/h5/?id=".concat(l.value))},S=function(){if(window.location.host.includes("localhost"))return L(l.value,{}),!1;Object(P["a"])({method:"get",url:"/interact/drama/".concat(l.value)}).then((function(e){var t=e.code,n=e.msg||"";if(0!==t)return y["a"].error(n),!1;L(l.value,e.data)})).catch((function(e){y["a"].error(e)}))};return Object(k["d"])(),i.dispatch("reset"),Object(a["onMounted"])((function(){setTimeout((function(){S()}),100)})),{route:t,router:n,store:i,state:u,curProperty:s,chapterList:f,previewDialog:p,editorId:l,openTree:O,showPreview:D,exportData:I,getEditorInfo:S,computed:a["computed"],onMounted:a["onMounted"],ref:a["ref"],useRoute:o["d"],useRouter:o["e"],useStore:r["b"],cloneDeep:c["cloneDeep"],HomeFilled:d,ChapterList:v["default"],ElementList:m["default"],ElementLibrary:b["default"],CanvasWrap:g["default"],Preview:h["default"],confirmLeave:j,message:y["a"],lf:x["a"],checkHasPlot:w["a"],saveCanvasData:C["a"],restoreCanvasData:L,axios:P["a"],setREM:k["d"]}}});n("675a");T.__scopeId="data-v-0d93cee5";t["default"]=T},fd38:function(e,t,n){"use strict";n("8c89")},fdaa:function(e,t,n){"use strict";n.r(t);n("2a26");var a=n("768f"),o=(n("4de4"),n("c740"),n("159b"),n("7a23")),r=n("5502"),c=n("b76a"),i=n.n(c),u=n("2ef0"),s=n("6256"),f=n("4ac8"),p=Object(o["defineComponent"])({expose:[],setup:function(e){var t=Object(r["b"])(),n=Object(o["computed"])((function(){return t.state.canvas.componentData})),c=Object(o["ref"])([]),p=Object(o["computed"])((function(){try{return t.state.property.data.element.id}catch(e){return""}})),l=Object(o["ref"])(!0),d=Object(o["ref"])(""),v=function(){l.value=!l.value},m=function(){d.value?(c.value.length=0,n.value.filter((function(e){var t=Object(u["cloneDeep"])(e),n=-1!=e.elementInfo.label.indexOf(d.value);n&&c.value.push(t)}))):h()},b=function(e){d.value="";var a=n.value.findIndex((function(t){return t.id===e})),o=n.value[a].eventList;o.forEach((function(e){t.commit("chapter/updateTreeChild",{type:"remove",childInfo:{target:{chapterId:"",plotId:e.target},source:{chapterId:e.source.chapterId,plotId:e.source.plotId,componentId:e.source.componentId,eventId:e.id}}})})),t.commit("canvas/deleteComponent",a),t.commit("property/changePanel",{type:"default"}),s["a"].success("删除成功")},g=function(e){if(d.value)return!1},h=function(){d.value="",c.value.length=0,n.value.forEach((function(e){var t=Object(u["cloneDeep"])(e);c.value.push(t)}))};return Object(o["watchEffect"])(h),{store:t,elementList:n,elementCloneList:c,curElementId:p,isOpenPanel:l,searchValue:d,togglePanel:v,search:m,removeElement:b,checkMove:g,initSearchData:h,computed:o["computed"],ref:o["ref"],watchEffect:o["watchEffect"],onMounted:o["onMounted"],useStore:r["b"],Popconfirm:a["a"],draggable:i.a,cloneDeep:u["cloneDeep"],message:s["a"],changePanel:f["a"]}}});n("3d60");p.__scopeId="data-v-1db7606c";t["default"]=p},fef0:function(e,t,n){}}]);